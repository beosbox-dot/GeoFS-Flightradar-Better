<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GeoFS Flight Tracker</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

<style>
/* ===== BASIC RESET ===== */
body, html {
  margin: 0;
  padding: 0;
  font-family: "Segoe UI", sans-serif;
  background: #0d0d0d;
  color: #fff;
  overflow: hidden;
}

/* ===== SIDEBAR ===== */
#sidebar {
  width: 250px;
  height: 100vh;
  background: linear-gradient(180deg, #111, #191919);
  color: #fff;
  float: left;
  display: flex;
  flex-direction: column;
  box-shadow: 2px 0 10px rgba(0,0,0,0.5);
}

#sidebar h1 {
  text-align: center;
  font-size: 20px;
  padding: 20px;
  background: #FF4136;
  margin: 0;
  letter-spacing: 1px;
}

#sidebar button {
  padding: 15px 20px;
  border: none;
  background: none;
  color: #fff;
  cursor: pointer;
  text-align: left;
  font-size: 15px;
  transition: 0.2s;
}

#sidebar button:hover {
  background: #222;
  border-left: 4px solid #FF4136;
}

/* ===== MAP ===== */
#map {
  position: absolute;
  left: 250px;
  top: 0;
  right: 0;
  bottom: 0;
  z-index: 1;
}

/* ===== FORM CONTAINER ===== */
#formContainer {
  display: none;
  position: absolute;
  top: 0;
  left: 250px;
  width: calc(100% - 250px);
  height: 100vh;
  background: #f5f5f5;
  color: #222;
  padding: 30px;
  overflow-y: auto;
  z-index: 2;
}

#flightForm {
  max-width: 500px;
  margin: 0 auto;
}

#flightForm h2 {
  text-align: center;
  color: #111;
}

#flightForm label {
  font-weight: bold;
  margin-top: 10px;
  display: block;
}

#flightForm input, #flightForm select {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  margin-bottom: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
}

#flightForm button {
  width: 100%;
  background: #FF4136;
  color: white;
  border: none;
  padding: 12px;
  font-size: 16px;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s;
}

#flightForm button:hover {
  background: #e0382e;
}

/* ===== SCROLLBAR ===== */
#formContainer::-webkit-scrollbar { width: 8px; }
#formContainer::-webkit-scrollbar-thumb {
  background: #bbb; border-radius: 4px;
}
</style>
</head>
<body>

<!-- ===== SIDEBAR ===== -->
<div id="sidebar">
  <h1>GeoFS Tracker</h1>
  <button onclick="showSection('home')">üè† Home</button>
  <button onclick="showSection('newFlight')">üõ´ New Flight</button>
  <button onclick="showSection('traffic')">üõ∞Ô∏è ADS-B Traffic</button>
  <button onclick="login()">üîê Login</button>
</div>

<!-- ===== MAP ===== -->
<div id="map"></div>

<!-- ===== FLIGHT FORM ===== -->
<div id="formContainer">
  <form id="flightForm">
    <h2>üõ´ Create New Flight</h2>
    <label>Departure Airport</label>
    <input type="text" id="departure" required placeholder="e.g. Sydney (YSSY)">
    <label>Arrival Airport</label>
    <input type="text" id="arrival" required placeholder="e.g. Singapore (WSSS)">
    <label>Flight Number</label>
    <input type="text" id="flightNumber" required placeholder="e.g. QF81">
    <label>Aircraft</label>
    <input type="text" id="aircraft" placeholder="e.g. Boeing 787-9">
    <label>Airlines</label>
    <input type="text" id="airlines" placeholder="e.g. Qantas Airways">
    <label>Upload Flight JS</label>
    <input type="file" id="flightFile" accept=".js">
    <button type="submit">Add Flight</button>
  </form>
</div>

<!-- ===== Leaflet JS ===== -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// === INITIAL MAP ===
const map = L.map('map').setView([-25, 134.5], 3);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors',
  maxZoom: 18
}).addTo(map);

let flightLayer = null;
let loggedUser = localStorage.getItem('user') || null;

// === Sidebar Navigation ===
function showSection(section) {
  const formContainer = document.getElementById('formContainer');
  formContainer.style.display = (section === 'newFlight') ? 'block' : 'none';
}

// === Login (Demo) ===
function login() {
  const user = prompt("Enter your username:");
  if (user) {
    localStorage.setItem('user', user);
    loggedUser = user;
    alert(`‚úÖ Logged in as ${user}`);
  }
}

// === Smooth Marker Animation ===
function animateFlight(route) {
  const icon = L.icon({
    iconUrl: "https://cdn-icons-png.flaticon.com/512/34/34627.png",
    iconSize: [28, 28],
    iconAnchor: [14, 14]
  });

  const plane = L.marker(route[0], { icon }).addTo(map);
  let i = 0;
  const interval = setInterval(() => {
    if (i < route.length) {
      plane.setLatLng(route[i]);
      i++;
    } else {
      clearInterval(interval);
    }
  }, 300);
}

// === Handle Flight Form ===
document.getElementById('flightForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const dep = document.getElementById('departure').value;
  const arr = document.getElementById('arrival').value;
  const flightNum = document.getElementById('flightNumber').value;
  const aircraft = document.getElementById('aircraft').value;
  const airlines = document.getElementById('airlines').value;
  const file = document.getElementById('flightFile').files[0];

  if (file) {
    const content = await file.text();
    console.log('üìÑ Uploaded Flight JS:', content);
  }

  // Sydney ‚Üí Singapore (demo)
  const depCoord = [-33.8688, 151.2093];
  const arrCoord = [1.3521, 103.8198];
  const route = [depCoord, arrCoord];

  if (flightLayer) map.removeLayer(flightLayer);

  flightLayer = L.polyline(route, {
    color: '#FF4136',
    weight: 4,
    opacity: 0.9
  }).addTo(map);

  map.fitBounds(flightLayer.getBounds(), { padding: [50, 50] });
  animateFlight(route);

  if (loggedUser) {
    const saved = JSON.parse(localStorage.getItem('flights') || '[]');
    saved.push({ dep, arr, flightNum, aircraft, airlines, date: new Date().toISOString() });
    localStorage.setItem('flights', JSON.stringify(saved));
  }

  alert(`‚úàÔ∏è Added: ${flightNum}\n${airlines} (${aircraft})\n${dep} ‚Üí ${arr}`);
});
</script>

</body>
</html>
