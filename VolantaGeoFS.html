<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.1">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!--</p>
<p class="p1">README:</p>
<p class="p1">- How to run: Open this file (index.html) directly in a modern browser or via VSCode Live Server.</p>
<p class="p1">- Data: Flight data is in the `flights` array inside &lt;script&gt; section (near top).</p>
<p class="p1">- To change maps provider: Currently uses Leaflet CDN; you can switch to Mapbox by replacing Leaflet initialization and tile layer with Mapbox code (commented hints provided).</p>
<p class="p1">- CDNs used:</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Leaflet (map &amp; polyline)</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Chart.js (flight hours chart)</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Google Platform (Google Sign-In)</p>
<p class="p1"><span class="Apple-converted-space">  </span>- ABD-S Live Traffic API (fetched live, no key required in demo)</p>
<p class="p1">- Features:</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Dark themed UI with defined color variables and transitions</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Sidebar with logbook: sortable, filterable, paginated flights table</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Search callsign filter</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Profile card with avatar, total flights, total hours, monthly flight hours chart</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Map with flight paths (glowing polyline), highlight on selection with zoom</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Realtime simulated playback with play/pause and speed control, marker moves along polyline</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Toggle display of all planes on map</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Export selected flight to GPX or JSON files</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Responsive layout: sidebar hidden on small screens, bottom sheet used</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Accessibility: keyboard focus, aria-labels, contrast</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Google Sign-In: save/load user data (mocked in localStorage for demo)</p>
<p class="p1"><span class="Apple-converted-space">  </span>- Live ADS-B traffic shown as moving markers (fetched live with flight info)</p>
<p class="p2"><br></p>
<p class="p1">NOTES:</p>
<p class="p1">- This is a single HTML file with modular JS and CSS sections.</p>
<p class="p1">- Comments explain each section and key code blocks.</p>
<p class="p1">--&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1">&lt;meta charset="UTF-8" /&gt;</p>
<p class="p1">&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</p>
<p class="p1">&lt;title&gt;Flight Logbook &amp; Map Replay&lt;/title&gt;</p>
<p class="p1">&lt;!-- Leaflet CSS --&gt;</p>
<p class="p1">&lt;link</p>
<p class="p1"><span class="Apple-converted-space">  </span>rel="stylesheet"</p>
<p class="p1"><span class="Apple-converted-space">  </span>href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"</p>
<p class="p1"><span class="Apple-converted-space">  </span>integrity="sha256-sA+4qZysnMj2qpaX6fK8eH8t0eC3kYbSlX+9Z5LxmRM="</p>
<p class="p1"><span class="Apple-converted-space">  </span>crossorigin=""</p>
<p class="p1">/&gt;</p>
<p class="p1">&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>:root {</p>
<p class="p1"><span class="Apple-converted-space">    </span>--color-bg: #0D1117;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--color-panel-bg: rgba(28, 33, 40, 0.6);</p>
<p class="p1"><span class="Apple-converted-space">    </span>--color-accent: #58A6FF;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--color-text-primary: #C9D1D9;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--color-text-muted: #8B949E;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--shadow-soft: 0 6px 20px rgba(0, 0, 0, 0.6);</p>
<p class="p1"><span class="Apple-converted-space">    </span>--transition: 0.18s ease;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,</p>
<p class="p1"><span class="Apple-converted-space">      </span>Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>* {</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-sizing: border-box;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>body {</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-bg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-text-primary);</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-family: var(--font-family);</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 100vh;</p>
<p class="p1"><span class="Apple-converted-space">    </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Sidebar / Logbook */</p>
<p class="p1"><span class="Apple-converted-space">  </span>#sidebar {</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 320px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-panel-bg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-shadow: var(--shadow-soft);</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 16px 12px 12px 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition: transform var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">    </span>z-index: 999;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#sidebar.hidden {</p>
<p class="p1"><span class="Apple-converted-space">    </span>transform: translateX(-110%);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#sidebar h2 {</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 0 0 12px 4px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 1.3rem;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Search &amp; filters */</p>
<p class="p1"><span class="Apple-converted-space">  </span>#search-filter {</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin-bottom: 8px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#search-filter input,</p>
<p class="p1"><span class="Apple-converted-space">  </span>#search-filter select {</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 6px 8px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin-bottom: 8px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">    </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: #1c2128;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-text-primary);</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition: box-shadow var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#search-filter input:focus,</p>
<p class="p1"><span class="Apple-converted-space">  </span>#search-filter select:focus {</p>
<p class="p1"><span class="Apple-converted-space">    </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-shadow: 0 0 6px var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Logbook table */</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table {</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-collapse: collapse;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-text-primary);</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 0.85rem;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table thead tr {</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-bottom: 1px solid var(--color-text-muted);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table th,</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table td {</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 6px 8px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>text-align: left;</p>
<p class="p1"><span class="Apple-converted-space">    </span>user-select: none;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table th {</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table th:hover,</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table th:focus {</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table th:after {</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: "";</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">    </span>right: 8px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>top: 50%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 8px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 8px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin-top: -4px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-style: solid;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-width: 4px 4px 0 4px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-color: var(--color-text-muted) transparent transparent transparent;</p>
<p class="p1"><span class="Apple-converted-space">    </span>pointer-events: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition: transform var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table th.sort-asc:after {</p>
<p class="p1"><span class="Apple-converted-space">    </span>transform: rotate(180deg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-color: var(--color-accent) transparent transparent transparent;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table th.sort-desc:after {</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-color: var(--color-accent) transparent transparent transparent;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table tbody tr {</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition: background-color var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table tbody tr:hover,</p>
<p class="p1"><span class="Apple-converted-space">  </span>#logbook-table tbody tr:focus {</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-bg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Pagination */</p>
<p class="p1"><span class="Apple-converted-space">  </span>#pagination {</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin-top: 8px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gap: 8px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#pagination button {</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-panel-bg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-text-primary);</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 6px 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-shadow: var(--shadow-soft);</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition: background-color var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#pagination button:disabled {</p>
<p class="p1"><span class="Apple-converted-space">    </span>opacity: 0.3;</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: default;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#pagination button:hover:not(:disabled),</p>
<p class="p1"><span class="Apple-converted-space">  </span>#pagination button:focus:not(:disabled) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-bg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Profile card */</p>
<p class="p1"><span class="Apple-converted-space">  </span>#profile {</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-panel-bg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-shadow: var(--shadow-soft);</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 16px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 280px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">    </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>user-select: none;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#profile img.avatar {</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 96px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 96px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: 50%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-shadow: 0 0 8px var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin-bottom: 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>object-fit: cover;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#profile h3 {</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 0 0 8px 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 1.4rem;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#profile .stats {</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gap: 24px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin-bottom: 16px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#profile .stats div {</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-text-muted);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#profile .stats div span.value {</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-text-primary);</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 1.1rem;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#profile canvas {</p>
<p class="p1"><span class="Apple-converted-space">    </span>max-width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Main content - map + controls */</p>
<p class="p1"><span class="Apple-converted-space">  </span>#main {</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex: 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-shadow: var(--shadow-soft);</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-panel-bg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#map {</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex: 1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Playback controls */</p>
<p class="p1"><span class="Apple-converted-space">  </span>#controls {</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 8px 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gap: 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: #1c2128;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#controls button,</p>
<p class="p1"><span class="Apple-converted-space">  </span>#controls input[type="range"] {</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition: background-color var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#controls button {</p>
<p class="p1"><span class="Apple-converted-space">    </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-bg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 6px 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">    </span>user-select: none;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#controls button:focus {</p>
<p class="p1"><span class="Apple-converted-space">    </span>outline: 2px solid var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#controls button:disabled {</p>
<p class="p1"><span class="Apple-converted-space">    </span>opacity: 0.5;</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: default;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#controls input[type="range"] {</p>
<p class="p1"><span class="Apple-converted-space">    </span>-webkit-appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: #444c5e;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 6px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>flex: 1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#controls input[type="range"]:focus {</p>
<p class="p1"><span class="Apple-converted-space">    </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-shadow: 0 0 6px var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#controls input[type="range"]::-webkit-slider-thumb {</p>
<p class="p1"><span class="Apple-converted-space">    </span>-webkit-appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 18px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 18px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: 50%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin-top: -6px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition: background-color var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#controls input[type="range"]::-moz-range-thumb {</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 18px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 18px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: 50%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition: background-color var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Export buttons */</p>
<p class="p1"><span class="Apple-converted-space">  </span>#export-buttons {</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gap: 8px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#export-buttons button {</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 6px 8px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 0.85rem;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-bg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>user-select: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition: background-color var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#export-buttons button:focus {</p>
<p class="p1"><span class="Apple-converted-space">    </span>outline: 2px solid var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Toggle planes and Google sign-in */</p>
<p class="p1"><span class="Apple-converted-space">  </span>#toggles {</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gap: 12px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#toggles label {</p>
<p class="p1"><span class="Apple-converted-space">    </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">    </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>gap: 6px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>user-select: none;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#toggles input[type="checkbox"] {</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 16px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 16px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Flight details panel */</p>
<p class="p1"><span class="Apple-converted-space">  </span>#flight-details {</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-panel-bg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 16px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-shadow: var(--shadow-soft);</p>
<p class="p1"><span class="Apple-converted-space">    </span>max-height: 300px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>overflow-y: auto;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: var(--color-text-primary);</p>
<p class="p1"><span class="Apple-converted-space">    </span>user-select: none;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#flight-details h3 {</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin-top: 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#flight-details p {</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 6px 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 0.9rem;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Accessibility focus for interactive elements */</p>
<p class="p1"><span class="Apple-converted-space">  </span>button:focus,</p>
<p class="p1"><span class="Apple-converted-space">  </span>input:focus,</p>
<p class="p1"><span class="Apple-converted-space">  </span>select:focus,</p>
<p class="p1"><span class="Apple-converted-space">  </span>th:focus,</p>
<p class="p1"><span class="Apple-converted-space">  </span>tr:focus {</p>
<p class="p1"><span class="Apple-converted-space">    </span>outline: 2px solid var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>outline-offset: 2px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Responsive */</p>
<p class="p1"><span class="Apple-converted-space">  </span>@media (max-width: 900px) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>#sidebar {</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: fixed;</p>
<p class="p1"><span class="Apple-converted-space">      </span>bottom: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>left: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>right: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">      </span>height: 40vh;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: var(--border-radius) var(--border-radius) 0 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>transform: translateY(100%);</p>
<p class="p1"><span class="Apple-converted-space">      </span>transition: transform var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">      </span>z-index: 9999;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 12px 12px 8px 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">      </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>#sidebar.visible {</p>
<p class="p1"><span class="Apple-converted-space">      </span>transform: translateY(0);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>#main {</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin: 12px 12px 60vh 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>#profile {</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>#toggle-sidebar-btn {</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: fixed;</p>
<p class="p1"><span class="Apple-converted-space">      </span>bottom: 48vh;</p>
<p class="p1"><span class="Apple-converted-space">      </span>right: 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">      </span>color: var(--color-bg);</p>
<p class="p1"><span class="Apple-converted-space">      </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: var(--border-radius);</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 8px 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>box-shadow: var(--shadow-soft);</p>
<p class="p1"><span class="Apple-converted-space">      </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">      </span>z-index: 10000;</p>
<p class="p1"><span class="Apple-converted-space">      </span>user-select: none;</p>
<p class="p1"><span class="Apple-converted-space">      </span>transition: background-color var(--transition);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>#toggle-sidebar-btn:focus {</p>
<p class="p1"><span class="Apple-converted-space">      </span>outline: 2px solid var(--color-accent);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Leaflet map overrides */</p>
<p class="p1"><span class="Apple-converted-space">  </span>.leaflet-container {</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: var(--color-bg);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Glowing polyline styles via class, actual glow done in JS */</p>
<p class="p1"><span class="Apple-converted-space">  </span>.glow-polyline {</p>
<p class="p1"><span class="Apple-converted-space">    </span>filter: drop-shadow(0 0 4px var(--color-accent));</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Sidebar / Logbook --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;aside id="sidebar" aria-label="Flight logbook and search filters" tabindex="-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;h2&gt;Flight Logbook&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="search-filter"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;input</p>
<p class="p1"><span class="Apple-converted-space">        </span>type="text"</p>
<p class="p1"><span class="Apple-converted-space">        </span>id="search-callsign"</p>
<p class="p1"><span class="Apple-converted-space">        </span>placeholder="Search Callsign"</p>
<p class="p1"><span class="Apple-converted-space">        </span>aria-label="Search flights by callsign"</p>
<p class="p1"><span class="Apple-converted-space">        </span>autocomplete="off"</p>
<p class="p1"><span class="Apple-converted-space">      </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;select id="filter-airport" aria-label="Filter by airport"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;option value=""&gt;All Airports&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;input type="date" id="filter-date" aria-label="Filter by flight date" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;table id="logbook-table" role="grid" aria-label="Flight logbook table" tabindex="0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th tabindex="0" data-sort="flight_id" aria-sort="none" scope="col"&gt;ID&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th tabindex="0" data-sort="pilot" aria-sort="none" scope="col"&gt;Pilot&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th tabindex="0" data-sort="departure" aria-sort="none" scope="col"&gt;Departure&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th tabindex="0" data-sort="arrival" aria-sort="none" scope="col"&gt;Arrival&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th tabindex="0" data-sort="start_time" aria-sort="none" scope="col"&gt;Date&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th tabindex="0" data-sort="distance_nm" aria-sort="none" scope="col"&gt;Dist (NM)&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;tbody&gt;&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="pagination" role="navigation" aria-label="Flight logbook pagination"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/aside&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Profile Card --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;section id="profile" aria-label="User profile and flight stats"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;img</p>
<p class="p1"><span class="Apple-converted-space">      </span>src="https://i.pravatar.cc/96"</p>
<p class="p1"><span class="Apple-converted-space">      </span>alt="User avatar"</p>
<p class="p1"><span class="Apple-converted-space">      </span>class="avatar"</p>
<p class="p1"><span class="Apple-converted-space">      </span>id="user-avatar"</p>
<p class="p1"><span class="Apple-converted-space">      </span>width="96"</p>
<p class="p1"><span class="Apple-converted-space">      </span>height="96"</p>
<p class="p1"><span class="Apple-converted-space">      </span>loading="lazy"</p>
<p class="p1"><span class="Apple-converted-space">    </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;h3 id="user-name"&gt;Guest User&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="stats" aria-live="polite"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div&gt;&lt;span class="value" id="total-flights"&gt;0&lt;/span&gt; Flights&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div&gt;&lt;span class="value" id="total-hours"&gt;0.0&lt;/span&gt; Hours&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;canvas id="hours-chart" width="280" height="140" aria-label="Flight hours chart"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button id="google-signin-btn" aria-label="Sign in with Google"&gt;Sign in with Google&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button id="google-signout-btn" aria-label="Sign out" hidden&gt;Sign out&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Main content: Map + playback + flight details --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;main id="main" role="main"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="map" tabindex="0" aria-label="Flight map"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="controls" aria-label="Flight playback controls"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button id="play-pause-btn" aria-pressed="false" aria-label="Play flight replay"&gt;Play&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;input</p>
<p class="p1"><span class="Apple-converted-space">        </span>type="range"</p>
<p class="p1"><span class="Apple-converted-space">        </span>id="speed-slider"</p>
<p class="p1"><span class="Apple-converted-space">        </span>min="0.5"</p>
<p class="p1"><span class="Apple-converted-space">        </span>max="5"</p>
<p class="p1"><span class="Apple-converted-space">        </span>value="1"</p>
<p class="p1"><span class="Apple-converted-space">        </span>step="0.1"</p>
<p class="p1"><span class="Apple-converted-space">        </span>aria-label="Playback speed slider"</p>
<p class="p1"><span class="Apple-converted-space">      </span>/&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;span id="speed-display"&gt;1x&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div id="toggles"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label&gt;&lt;input type="checkbox" id="toggle-planes" checked aria-checked="true" /&gt; Show Planes&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div id="export-buttons"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="export-gpx-btn" aria-label="Export selected flight to GPX"&gt;Export GPX&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="export-json-btn" aria-label="Export selected flight to JSON"&gt;Export JSON&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;section id="flight-details" aria-live="polite" tabindex="0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h3&gt;Flight Details&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;p&gt;Select a flight from the logbook to see details here.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/section&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/main&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Toggle sidebar button for small screens --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;button id="toggle-sidebar-btn" aria-label="Toggle flight logbook sidebar" hidden&gt;Logbook&lt;/button&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Leaflet JS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script</p>
<p class="p1"><span class="Apple-converted-space">    </span>src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"</p>
<p class="p1"><span class="Apple-converted-space">    </span>integrity="sha256-o8y4cb0QdWk+T1khsdl1gE3Y5RZB1h7QJ7PLv3xg9eI="</p>
<p class="p1"><span class="Apple-converted-space">    </span>crossorigin=""</p>
<p class="p1"><span class="Apple-converted-space">  </span>&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Chart.js --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Google Platform Library --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script src="https://accounts.google.com/gsi/client" async defer&gt;&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>/*</p>
<p class="p1"><span class="Apple-converted-space">    </span>Flight Logbook &amp; Map Replay</p>
<p class="p1"><span class="Apple-converted-space">    </span>Author: AI Assistant</p>
<p class="p1"><span class="Apple-converted-space">    </span>Features:</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Flights data with sample flights embedded</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Logbook table: sortable, filterable, paginated</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Map with Leaflet: flight paths with glowing polylines</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Playback controls: play/pause, speed slider, marker moves along path</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Export flight data to GPX/JSON</p>
<p class="p1"><span class="Apple-converted-space">    </span>- User profile with Google Sign-In (mock save/load)</p>
<p class="p1"><span class="Apple-converted-space">    </span>- ADS-B live traffic overlay (live fetching)</p>
<p class="p1"><span class="Apple-converted-space">    </span>- Responsive design and accessibility</p>
<p class="p1"><span class="Apple-converted-space">    </span>*/</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// ==== Flight Data (internal JSON) with 4 sample flights ====</p>
<p class="p1"><span class="Apple-converted-space">    </span>const flights = [</p>
<p class="p1"><span class="Apple-converted-space">      </span>{</p>
<p class="p1"><span class="Apple-converted-space">        </span>flight_id: "FL001",</p>
<p class="p1"><span class="Apple-converted-space">        </span>pilot: "Alice Nguyen",</p>
<p class="p1"><span class="Apple-converted-space">        </span>callsign: "VNA123",</p>
<p class="p1"><span class="Apple-converted-space">        </span>departure: "VHHH",</p>
<p class="p1"><span class="Apple-converted-space">        </span>arrival: "RJTT",</p>
<p class="p1"><span class="Apple-converted-space">        </span>path: [</p>
<p class="p1"><span class="Apple-converted-space">          </span>[22.308, 113.918], // HKG</p>
<p class="p1"><span class="Apple-converted-space">          </span>[23.5, 120.0],</p>
<p class="p1"><span class="Apple-converted-space">          </span>[24.5, 125.0],</p>
<p class="p1"><span class="Apple-converted-space">          </span>[35.553, 139.779], // Tokyo Haneda</p>
<p class="p1"><span class="Apple-converted-space">        </span>],</p>
<p class="p1"><span class="Apple-converted-space">        </span>start_time: "2024-06-01T08:00:00Z",</p>
<p class="p1"><span class="Apple-converted-space">        </span>distance_nm: 1320,</p>
<p class="p1"><span class="Apple-converted-space">      </span>},</p>
<p class="p1"><span class="Apple-converted-space">      </span>{</p>
<p class="p1"><span class="Apple-converted-space">        </span>flight_id: "FL002",</p>
<p class="p1"><span class="Apple-converted-space">        </span>pilot: "Bob Tran",</p>
<p class="p1"><span class="Apple-converted-space">        </span>callsign: "VNA456",</p>
<p class="p1"><span class="Apple-converted-space">        </span>departure: "KJFK",</p>
<p class="p1"><span class="Apple-converted-space">        </span>arrival: "KLAX",</p>
<p class="p1"><span class="Apple-converted-space">        </span>path: [</p>
<p class="p1"><span class="Apple-converted-space">          </span>[40.6413, -73.7781], // JFK</p>
<p class="p1"><span class="Apple-converted-space">          </span>[39.0, -90.0],</p>
<p class="p1"><span class="Apple-converted-space">          </span>[37.0, -110.0],</p>
<p class="p1"><span class="Apple-converted-space">          </span>[33.9416, -118.4085], // LAX</p>
<p class="p1"><span class="Apple-converted-space">        </span>],</p>
<p class="p1"><span class="Apple-converted-space">        </span>start_time: "2024-06-05T14:30:00Z",</p>
<p class="p1"><span class="Apple-converted-space">        </span>distance_nm: 2150,</p>
<p class="p1"><span class="Apple-converted-space">      </span>},</p>
<p class="p1"><span class="Apple-converted-space">      </span>{</p>
<p class="p1"><span class="Apple-converted-space">        </span>flight_id: "FL003",</p>
<p class="p1"><span class="Apple-converted-space">        </span>pilot: "Charlie Pham",</p>
<p class="p1"><span class="Apple-converted-space">        </span>callsign: "VNA789",</p>
<p class="p1"><span class="Apple-converted-space">        </span>departure: "EGLL",</p>
<p class="p1"><span class="Apple-converted-space">        </span>arrival: "LFPG",</p>
<p class="p1"><span class="Apple-converted-space">        </span>path: [</p>
<p class="p1"><span class="Apple-converted-space">          </span>[51.4700, -0.4543], // London Heathrow</p>
<p class="p1"><span class="Apple-converted-space">          </span>[50.5, 1.5],</p>
<p class="p1"><span class="Apple-converted-space">          </span>[49.0097, 2.5479], // Paris Charles de Gaulle</p>
<p class="p1"><span class="Apple-converted-space">        </span>],</p>
<p class="p1"><span class="Apple-converted-space">        </span>start_time: "2024-06-10T09:15:00Z",</p>
<p class="p1"><span class="Apple-converted-space">        </span>distance_nm: 215,</p>
<p class="p1"><span class="Apple-converted-space">      </span>},</p>
<p class="p1"><span class="Apple-converted-space">      </span>{</p>
<p class="p1"><span class="Apple-converted-space">        </span>flight_id: "FL004",</p>
<p class="p1"><span class="Apple-converted-space">        </span>pilot: "Diana Le",</p>
<p class="p1"><span class="Apple-converted-space">        </span>callsign: "VNA321",</p>
<p class="p1"><span class="Apple-converted-space">        </span>departure: "YSSY",</p>
<p class="p1"><span class="Apple-converted-space">        </span>arrival: "NZAA",</p>
<p class="p1"><span class="Apple-converted-space">        </span>path: [</p>
<p class="p1"><span class="Apple-converted-space">          </span>[-33.9399, 151.1753], // Sydney</p>
<p class="p1"><span class="Apple-converted-space">          </span>[-35.0, 160.0],</p>
<p class="p1"><span class="Apple-converted-space">          </span>[-37.0081, 174.7850], // Auckland</p>
<p class="p1"><span class="Apple-converted-space">        </span>],</p>
<p class="p1"><span class="Apple-converted-space">        </span>start_time: "2024-06-15T22:00:00Z",</p>
<p class="p1"><span class="Apple-converted-space">        </span>distance_nm: 1140,</p>
<p class="p1"><span class="Apple-converted-space">      </span>},</p>
<p class="p1"><span class="Apple-converted-space">    </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Globals ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>const PAGE_SIZE = 5;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let currentPage = 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let currentSort = { key: "start_time", direction: "desc" };</p>
<p class="p1"><span class="Apple-converted-space">    </span>let filteredFlights = [...flights];</p>
<p class="p1"><span class="Apple-converted-space">    </span>let selectedFlight = null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let map, flightLayerGroup, playbackMarker, playbackInterval, playbackSpeed = 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let playbackIndex = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let isPlaying = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let planesLayerGroup, adsbLayerGroup;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let userData = {</p>
<p class="p1"><span class="Apple-converted-space">      </span>name: "Guest User",</p>
<p class="p1"><span class="Apple-converted-space">      </span>avatar: "https://i.pravatar.cc/96",</p>
<p class="p1"><span class="Apple-converted-space">      </span>flights: flights,</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === DOM Elements ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>const sidebar = document.getElementById("sidebar");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const profile = document.getElementById("profile");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const logbookTbody = document.querySelector("#logbook-table tbody");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const paginationDiv = document.getElementById("pagination");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const searchCallsignInput = document.getElementById("search-callsign");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const filterAirportSelect = document.getElementById("filter-airport");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const filterDateInput = document.getElementById("filter-date");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const playPauseBtn = document.getElementById("play-pause-btn");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const speedSlider = document.getElementById("speed-slider");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const speedDisplay = document.getElementById("speed-display");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const togglePlanesCheckbox = document.getElementById("toggle-planes");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const exportGpxBtn = document.getElementById("export-gpx-btn");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const exportJsonBtn = document.getElementById("export-json-btn");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const flightDetailsSection = document.getElementById("flight-details");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const userNameElem = document.getElementById("user-name");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const userAvatarElem = document.getElementById("user-avatar");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const totalFlightsElem = document.getElementById("total-flights");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const totalHoursElem = document.getElementById("total-hours");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const googleSignInBtn = document.getElementById("google-signin-btn");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const googleSignOutBtn = document.getElementById("google-signout-btn");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const toggleSidebarBtn = document.getElementById("toggle-sidebar-btn");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Utilities ===</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Format date YYYY-MM-DD</p>
<p class="p1"><span class="Apple-converted-space">    </span>function formatDate(date) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const d = new Date(date);</p>
<p class="p1"><span class="Apple-converted-space">      </span>return d.toISOString().slice(0, 10);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Format date/time for display</p>
<p class="p1"><span class="Apple-converted-space">    </span>function formatDateTime(date) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const d = new Date(date);</p>
<p class="p1"><span class="Apple-converted-space">      </span>return d.toLocaleString(undefined, {</p>
<p class="p1"><span class="Apple-converted-space">        </span>year: "numeric",</p>
<p class="p1"><span class="Apple-converted-space">        </span>month: "short",</p>
<p class="p1"><span class="Apple-converted-space">        </span>day: "numeric",</p>
<p class="p1"><span class="Apple-converted-space">        </span>hour: "2-digit",</p>
<p class="p1"><span class="Apple-converted-space">        </span>minute: "2-digit",</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Calculate total flight hours for user (sum of distances / avg speed ~ 450kt)</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calcTotalHours(flights) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const totalNm = flights.reduce((acc, f) =&gt; acc + f.distance_nm, 0);</p>
<p class="p1"><span class="Apple-converted-space">      </span>return (totalNm / 450).toFixed(1);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Extract unique airports from flights for filter</p>
<p class="p1"><span class="Apple-converted-space">    </span>function extractAirports(flights) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const airports = new Set();</p>
<p class="p1"><span class="Apple-converted-space">      </span>flights.forEach((f) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>airports.add(f.departure);</p>
<p class="p1"><span class="Apple-converted-space">        </span>airports.add(f.arrival);</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>return Array.from(airports).sort();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Throttle function for performance (limit calls)</p>
<p class="p1"><span class="Apple-converted-space">    </span>function throttle(func, wait) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>let lastTime = 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>return function (...args) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const now = Date.now();</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (now - lastTime &gt;= wait) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>lastTime = now;</p>
<p class="p1"><span class="Apple-converted-space">          </span>func.apply(this, args);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Convert flight path to GPX XML string</p>
<p class="p1"><span class="Apple-converted-space">    </span>function flightToGpx(flight) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const gpxHeader =</p>
<p class="p1"><span class="Apple-converted-space">        </span>'&lt;?xml version="1.0" encoding="UTF-8"?&gt;\n' +</p>
<p class="p1"><span class="Apple-converted-space">        </span>'&lt;gpx version="1.1" creator="FlightLogbookAI" xmlns="http://www.topografix.com/GPX/1/1"&gt;\n' +</p>
<p class="p1"><span class="Apple-converted-space">        </span>`&lt;trk&gt;&lt;name&gt;${flight.flight_id}&lt;/name&gt;&lt;trkseg&gt;\n`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const gpxFooter = "&lt;/trkseg&gt;&lt;/trk&gt;\n&lt;/gpx&gt;";</p>
<p class="p1"><span class="Apple-converted-space">      </span>const points = flight.path</p>
<p class="p1"><span class="Apple-converted-space">        </span>.map(</p>
<p class="p1"><span class="Apple-converted-space">          </span>([lat, lon]) =&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>`&lt;trkpt lat="${lat.toFixed(6)}" lon="${lon.toFixed(6)}"&gt;&lt;/trkpt&gt;`</p>
<p class="p1"><span class="Apple-converted-space">        </span>)</p>
<p class="p1"><span class="Apple-converted-space">        </span>.join("\n");</p>
<p class="p1"><span class="Apple-converted-space">      </span>return gpxHeader + points + "\n" + gpxFooter;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Download text as file</p>
<p class="p1"><span class="Apple-converted-space">    </span>function downloadFile(filename, content, mime = "text/plain") {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const blob = new Blob([content], { type: mime });</p>
<p class="p1"><span class="Apple-converted-space">      </span>const url = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const a = document.createElement("a");</p>
<p class="p1"><span class="Apple-converted-space">      </span>a.href = url;</p>
<p class="p1"><span class="Apple-converted-space">      </span>a.download = filename;</p>
<p class="p1"><span class="Apple-converted-space">      </span>document.body.appendChild(a);</p>
<p class="p1"><span class="Apple-converted-space">      </span>a.click();</p>
<p class="p1"><span class="Apple-converted-space">      </span>document.body.removeChild(a);</p>
<p class="p1"><span class="Apple-converted-space">      </span>URL.revokeObjectURL(url);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Map Initialization ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>function initMap() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>map = L.map("map", {</p>
<p class="p1"><span class="Apple-converted-space">        </span>center: [20, 0],</p>
<p class="p1"><span class="Apple-converted-space">        </span>zoom: 2,</p>
<p class="p1"><span class="Apple-converted-space">        </span>zoomControl: true,</p>
<p class="p1"><span class="Apple-converted-space">        </span>keyboard: true,</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Leaflet tile layer (OpenStreetMap)</p>
<p class="p1"><span class="Apple-converted-space">      </span>L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {</p>
<p class="p1"><span class="Apple-converted-space">        </span>attribution:</p>
<p class="p1"><span class="Apple-converted-space">          </span>'&amp;copy; &lt;a href="https://openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; contributors',</p>
<p class="p1"><span class="Apple-converted-space">        </span>maxZoom: 18,</p>
<p class="p1"><span class="Apple-converted-space">      </span>}).addTo(map);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>/*</p>
<p class="p1"><span class="Apple-converted-space">      </span>// To switch to Mapbox (requires access token):</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Replace above tileLayer with:</p>
<p class="p1"><span class="Apple-converted-space">      </span>// L.tileLayer(</p>
<p class="p1"><span class="Apple-converted-space">      </span>// <span class="Apple-converted-space">  </span>`https://api.mapbox.com/styles/v1/mapbox/dark-v11/tiles/{z}/{x}/{y}?access_token=YOUR_MAPBOX_TOKEN`,</p>
<p class="p1"><span class="Apple-converted-space">      </span>// <span class="Apple-converted-space">  </span>{</p>
<p class="p1"><span class="Apple-converted-space">      </span>// <span class="Apple-converted-space">    </span>maxZoom: 18,</p>
<p class="p1"><span class="Apple-converted-space">      </span>// <span class="Apple-converted-space">    </span>tileSize: 512,</p>
<p class="p1"><span class="Apple-converted-space">      </span>// <span class="Apple-converted-space">    </span>zoomOffset: -1,</p>
<p class="p1"><span class="Apple-converted-space">      </span>// <span class="Apple-converted-space">    </span>attribution:</p>
<p class="p1"><span class="Apple-converted-space">      </span>// <span class="Apple-converted-space">      </span>'© &lt;a href="https://www.mapbox.com/about/maps/"&gt;Mapbox&lt;/a&gt; © OpenStreetMap',</p>
<p class="p1"><span class="Apple-converted-space">      </span>// <span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>// ).addTo(map);</p>
<p class="p1"><span class="Apple-converted-space">      </span>*/</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>flightLayerGroup = L.layerGroup().addTo(map);</p>
<p class="p1"><span class="Apple-converted-space">      </span>planesLayerGroup = L.layerGroup().addTo(map);</p>
<p class="p1"><span class="Apple-converted-space">      </span>adsbLayerGroup = L.layerGroup().addTo(map);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Create glowing polyline for flight path</p>
<p class="p1"><span class="Apple-converted-space">    </span>function createGlowingPolyline(latlngs) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Create 2 polylines: one thick with opacity for glow, one normal on top</p>
<p class="p1"><span class="Apple-converted-space">      </span>const glow = L.polyline(latlngs, {</p>
<p class="p1"><span class="Apple-converted-space">        </span>color: "var(--color-accent)",</p>
<p class="p1"><span class="Apple-converted-space">        </span>weight: 12,</p>
<p class="p1"><span class="Apple-converted-space">        </span>opacity: 0.2,</p>
<p class="p1"><span class="Apple-converted-space">        </span>className: "glow-polyline",</p>
<p class="p1"><span class="Apple-converted-space">        </span>interactive: false,</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>const line = L.polyline(latlngs, {</p>
<p class="p1"><span class="Apple-converted-space">        </span>color: "var(--color-accent)",</p>
<p class="p1"><span class="Apple-converted-space">        </span>weight: 4,</p>
<p class="p1"><span class="Apple-converted-space">        </span>opacity: 1,</p>
<p class="p1"><span class="Apple-converted-space">        </span>interactive: false,</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>return L.layerGroup([glow, line]);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Zoom and highlight selected flight path on map</p>
<p class="p1"><span class="Apple-converted-space">    </span>function highlightFlightOnMap(flight) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>flightLayerGroup.clearLayers();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!flight || !flight.path || flight.path.length &lt; 2) return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const latlngs = flight.path.map(([lat, lon]) =&gt; [lat, lon]);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const polylineGroup = createGlowingPolyline(latlngs);</p>
<p class="p1"><span class="Apple-converted-space">      </span>polylineGroup.addTo(flightLayerGroup);</p>
<p class="p1"><span class="Apple-converted-space">      </span>map.fitBounds(L.polyline(latlngs).getBounds(), { padding: [50, 50] });</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Setup playback marker</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (playbackMarker) flightLayerGroup.removeLayer(playbackMarker);</p>
<p class="p1"><span class="Apple-converted-space">      </span>playbackMarker = L.circleMarker(latlngs[0], {</p>
<p class="p1"><span class="Apple-converted-space">        </span>radius: 8,</p>
<p class="p1"><span class="Apple-converted-space">        </span>color: "#58A6FF",</p>
<p class="p1"><span class="Apple-converted-space">        </span>fillColor: "#58A6FF",</p>
<p class="p1"><span class="Apple-converted-space">        </span>fillOpacity: 1,</p>
<p class="p1"><span class="Apple-converted-space">        </span>weight: 2,</p>
<p class="p1"><span class="Apple-converted-space">        </span>interactive: false,</p>
<p class="p1"><span class="Apple-converted-space">      </span>}).addTo(flightLayerGroup);</p>
<p class="p1"><span class="Apple-converted-space">      </span>playbackIndex = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Logbook Table ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Sort flights by key &amp; direction</p>
<p class="p1"><span class="Apple-converted-space">    </span>function sortFlights(flights, key, direction) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const dir = direction === "asc" ? 1 : -1;</p>
<p class="p1"><span class="Apple-converted-space">      </span>return flights.slice().sort((a, b) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (key === "start_time") {</p>
<p class="p1"><span class="Apple-converted-space">          </span>return (</p>
<p class="p1"><span class="Apple-converted-space">            </span>(new Date(a[key]) - new Date(b[key])) * dir</p>
<p class="p1"><span class="Apple-converted-space">          </span>);</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if (typeof a[key] === "string") {</p>
<p class="p1"><span class="Apple-converted-space">          </span>return a[key].localeCompare(b[key]) * dir;</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">          </span>return (a[key] - b[key]) * dir;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Render logbook table body with pagination</p>
<p class="p1"><span class="Apple-converted-space">    </span>function renderLogbookTable() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const start = (currentPage - 1) * PAGE_SIZE;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const end = start + PAGE_SIZE;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const pageFlights = filteredFlights.slice(start, end);</p>
<p class="p1"><span class="Apple-converted-space">      </span>logbookTbody.innerHTML = "";</p>
<p class="p1"><span class="Apple-converted-space">      </span>for (const flight of pageFlights) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const tr = document.createElement("tr");</p>
<p class="p1"><span class="Apple-converted-space">        </span>tr.tabIndex = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>tr.setAttribute("role", "row");</p>
<p class="p1"><span class="Apple-converted-space">        </span>tr.dataset.flightId = flight.flight_id;</p>
<p class="p1"><span class="Apple-converted-space">        </span>tr.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;td&gt;${flight.flight_id}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;td&gt;${flight.pilot}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;td&gt;${flight.departure}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;td&gt;${flight.arrival}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;td&gt;${formatDate(flight.start_time)}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;td&gt;${flight.distance_nm}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>tr.addEventListener("click", () =&gt; selectFlightById(flight.flight_id));</p>
<p class="p1"><span class="Apple-converted-space">        </span>tr.addEventListener("keydown", (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">          </span>if (e.key === "Enter" || e.key === " ") {</p>
<p class="p1"><span class="Apple-converted-space">            </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">            </span>selectFlightById(flight.flight_id);</p>
<p class="p1"><span class="Apple-converted-space">          </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>logbookTbody.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>renderPagination();</p>
<p class="p1"><span class="Apple-converted-space">      </span>updateSortIndicators();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Render pagination buttons</p>
<p class="p1"><span class="Apple-converted-space">    </span>function renderPagination() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>paginationDiv.innerHTML = "";</p>
<p class="p1"><span class="Apple-converted-space">      </span>const totalPages = Math.ceil(filteredFlights.length / PAGE_SIZE);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const prevBtn = document.createElement("button");</p>
<p class="p1"><span class="Apple-converted-space">      </span>prevBtn.textContent = "Prev";</p>
<p class="p1"><span class="Apple-converted-space">      </span>prevBtn.disabled = currentPage === 1;</p>
<p class="p1"><span class="Apple-converted-space">      </span>prevBtn.addEventListener("click", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (currentPage &gt; 1) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>currentPage--;</p>
<p class="p1"><span class="Apple-converted-space">          </span>renderLogbookTable();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>paginationDiv.appendChild(prevBtn);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const pageInfo = document.createElement("span");</p>
<p class="p1"><span class="Apple-converted-space">      </span>pageInfo.textContent = ` Page ${currentPage} / ${totalPages} `;</p>
<p class="p1"><span class="Apple-converted-space">      </span>pageInfo.style.color = "var(--color-text-muted)";</p>
<p class="p1"><span class="Apple-converted-space">      </span>pageInfo.style.alignSelf = "center";</p>
<p class="p1"><span class="Apple-converted-space">      </span>paginationDiv.appendChild(pageInfo);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const nextBtn = document.createElement("button");</p>
<p class="p1"><span class="Apple-converted-space">      </span>nextBtn.textContent = "Next";</p>
<p class="p1"><span class="Apple-converted-space">      </span>nextBtn.disabled = currentPage === totalPages || totalPages === 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>nextBtn.addEventListener("click", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (currentPage &lt; totalPages) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>currentPage++;</p>
<p class="p1"><span class="Apple-converted-space">          </span>renderLogbookTable();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>paginationDiv.appendChild(nextBtn);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Update sort arrow indicators on table headers</p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateSortIndicators() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const headers = document.querySelectorAll("#logbook-table th");</p>
<p class="p1"><span class="Apple-converted-space">      </span>headers.forEach((th) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>th.classList.remove("sort-asc", "sort-desc");</p>
<p class="p1"><span class="Apple-converted-space">        </span>th.setAttribute("aria-sort", "none");</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>const activeTh = document.querySelector(</p>
<p class="p1"><span class="Apple-converted-space">        </span>`#logbook-table th[data-sort="${currentSort.key}"]`</p>
<p class="p1"><span class="Apple-converted-space">      </span>);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (activeTh) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>activeTh.classList.add(</p>
<p class="p1"><span class="Apple-converted-space">          </span>currentSort.direction === "asc" ? "sort-asc" : "sort-desc"</p>
<p class="p1"><span class="Apple-converted-space">        </span>);</p>
<p class="p1"><span class="Apple-converted-space">        </span>activeTh.setAttribute(</p>
<p class="p1"><span class="Apple-converted-space">          </span>"aria-sort",</p>
<p class="p1"><span class="Apple-converted-space">          </span>currentSort.direction === "asc" ? "ascending" : "descending"</p>
<p class="p1"><span class="Apple-converted-space">        </span>);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Filter flights according to search inputs</p>
<p class="p1"><span class="Apple-converted-space">    </span>function applyFilters() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const callsignFilter = searchCallsignInput.value.trim().toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const airportFilter = filterAirportSelect.value;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const dateFilter = filterDateInput.value; // YYYY-MM-DD</p>
<p class="p1"><span class="Apple-converted-space">      </span>filteredFlights = flights.filter((f) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>let match = true;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (callsignFilter) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>match =</p>
<p class="p1"><span class="Apple-converted-space">            </span>f.callsign.toLowerCase().includes(callsignFilter) ||</p>
<p class="p1"><span class="Apple-converted-space">            </span>f.pilot.toLowerCase().includes(callsignFilter);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (match &amp;&amp; airportFilter) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>match = f.departure === airportFilter || f.arrival === airportFilter;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (match &amp;&amp; dateFilter) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>match = formatDate(f.start_time) === dateFilter;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>return match;</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>filteredFlights = sortFlights(</p>
<p class="p1"><span class="Apple-converted-space">        </span>filteredFlights,</p>
<p class="p1"><span class="Apple-converted-space">        </span>currentSort.key,</p>
<p class="p1"><span class="Apple-converted-space">        </span>currentSort.direction</p>
<p class="p1"><span class="Apple-converted-space">      </span>);</p>
<p class="p1"><span class="Apple-converted-space">      </span>currentPage = 1;</p>
<p class="p1"><span class="Apple-converted-space">      </span>renderLogbookTable();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Select flight by ID and update UI</p>
<p class="p1"><span class="Apple-converted-space">    </span>function selectFlightById(flightId) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>selectedFlight = flights.find((f) =&gt; f.flight_id === flightId);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!selectedFlight) return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>highlightFlightOnMap(selectedFlight);</p>
<p class="p1"><span class="Apple-converted-space">      </span>updateFlightDetails(selectedFlight);</p>
<p class="p1"><span class="Apple-converted-space">      </span>resetPlayback();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Update flight details panel with selected flight info</p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateFlightDetails(flight) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>flightDetailsSection.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h3&gt;Flight Details&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;&lt;strong&gt;Flight ID:&lt;/strong&gt; ${flight.flight_id}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;&lt;strong&gt;Callsign:&lt;/strong&gt; ${flight.callsign || "N/A"}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;&lt;strong&gt;Pilot:&lt;/strong&gt; ${flight.pilot}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;&lt;strong&gt;Departure:&lt;/strong&gt; ${flight.departure}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;&lt;strong&gt;Arrival:&lt;/strong&gt; ${flight.arrival}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;&lt;strong&gt;Start Time:&lt;/strong&gt; ${formatDateTime(flight.start_time)}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;&lt;strong&gt;Distance (NM):&lt;/strong&gt; ${flight.distance_nm}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;&lt;strong&gt;Path Points:&lt;/strong&gt; ${flight.path.length}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;&lt;em&gt;Use playback controls below to replay the flight path.&lt;/em&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Playback Controls ===</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Move marker along path with playback speed</p>
<p class="p1"><span class="Apple-converted-space">    </span>function playbackStep() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!selectedFlight || !playbackMarker) return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const latlngs = selectedFlight.path.map(([lat, lon]) =&gt; [lat, lon]);</p>
<p class="p1"><span class="Apple-converted-space">      </span>playbackIndex += playbackSpeed;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (playbackIndex &gt;= latlngs.length) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>playbackIndex = latlngs.length - 1;</p>
<p class="p1"><span class="Apple-converted-space">        </span>pausePlayback();</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>const idx = Math.floor(playbackIndex);</p>
<p class="p1"><span class="Apple-converted-space">      </span>playbackMarker.setLatLng(latlngs[idx]);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Play playback</p>
<p class="p1"><span class="Apple-converted-space">    </span>function playPlayback() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!selectedFlight) return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (isPlaying) return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>isPlaying = true;</p>
<p class="p1"><span class="Apple-converted-space">      </span>playPauseBtn.textContent = "Pause";</p>
<p class="p1"><span class="Apple-converted-space">      </span>playPauseBtn.setAttribute("aria-pressed", "true");</p>
<p class="p1"><span class="Apple-converted-space">      </span>playbackInterval = setInterval(playbackStep, 300);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Pause playback</p>
<p class="p1"><span class="Apple-converted-space">    </span>function pausePlayback() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!isPlaying) return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>isPlaying = false;</p>
<p class="p1"><span class="Apple-converted-space">      </span>playPauseBtn.textContent = "Play";</p>
<p class="p1"><span class="Apple-converted-space">      </span>playPauseBtn.setAttribute("aria-pressed", "false");</p>
<p class="p1"><span class="Apple-converted-space">      </span>clearInterval(playbackInterval);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Toggle play/pause</p>
<p class="p1"><span class="Apple-converted-space">    </span>function togglePlayPause() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (isPlaying) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>pausePlayback();</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>playPlayback();</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Reset playback marker to start</p>
<p class="p1"><span class="Apple-converted-space">    </span>function resetPlayback() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!selectedFlight || !playbackMarker) return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>playbackIndex = 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const latlngs = selectedFlight.path.map(([lat, lon]) =&gt; [lat, lon]);</p>
<p class="p1"><span class="Apple-converted-space">      </span>playbackMarker.setLatLng(latlngs[0]);</p>
<p class="p1"><span class="Apple-converted-space">      </span>pausePlayback();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Update speed from slider</p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateSpeed() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>playbackSpeed = parseFloat(speedSlider.value);</p>
<p class="p1"><span class="Apple-converted-space">      </span>speedDisplay.textContent = playbackSpeed.toFixed(1) + "x";</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Export Functions ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>function exportSelectedFlightGPX() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!selectedFlight) return alert("No flight selected");</p>
<p class="p1"><span class="Apple-converted-space">      </span>const gpx = flightToGpx(selectedFlight);</p>
<p class="p1"><span class="Apple-converted-space">      </span>downloadFile(selectedFlight.flight_id + ".gpx", gpx, "application/gpx+xml");</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function exportSelectedFlightJSON() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!selectedFlight) return alert("No flight selected");</p>
<p class="p1"><span class="Apple-converted-space">      </span>const jsonStr = JSON.stringify(selectedFlight, null, 2);</p>
<p class="p1"><span class="Apple-converted-space">      </span>downloadFile(selectedFlight.flight_id + ".json", jsonStr, "application/json");</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Profile &amp; Chart ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>let hoursChart = null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>function initProfile() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>userNameElem.textContent = userData.name;</p>
<p class="p1"><span class="Apple-converted-space">      </span>userAvatarElem.src = userData.avatar;</p>
<p class="p1"><span class="Apple-converted-space">      </span>totalFlightsElem.textContent = userData.flights.length;</p>
<p class="p1"><span class="Apple-converted-space">      </span>totalHoursElem.textContent = calcTotalHours(userData.flights);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Prepare monthly flight hours data for chart</p>
<p class="p1"><span class="Apple-converted-space">      </span>const monthlyHours = new Array(12).fill(0);</p>
<p class="p1"><span class="Apple-converted-space">      </span>userData.flights.forEach((f) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const d = new Date(f.start_time);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const month = d.getMonth();</p>
<p class="p1"><span class="Apple-converted-space">        </span>monthlyHours[month] += f.distance_nm / 450;</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>const ctx = document.getElementById("hours-chart").getContext("2d");</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (hoursChart) hoursChart.destroy();</p>
<p class="p1"><span class="Apple-converted-space">      </span>hoursChart = new Chart(ctx, {</p>
<p class="p1"><span class="Apple-converted-space">        </span>type: "bar",</p>
<p class="p1"><span class="Apple-converted-space">        </span>data: {</p>
<p class="p1"><span class="Apple-converted-space">          </span>labels: [</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Jan",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Feb",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Mar",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Apr",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"May",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Jun",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Jul",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Aug",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Sep",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Oct",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Nov",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Dec",</p>
<p class="p1"><span class="Apple-converted-space">          </span>],</p>
<p class="p1"><span class="Apple-converted-space">          </span>datasets: [</p>
<p class="p1"><span class="Apple-converted-space">            </span>{</p>
<p class="p1"><span class="Apple-converted-space">              </span>label: "Hours",</p>
<p class="p1"><span class="Apple-converted-space">              </span>data: monthlyHours.map((h) =&gt; h.toFixed(1)),</p>
<p class="p1"><span class="Apple-converted-space">              </span>backgroundColor: "rgba(88,166,255,0.7)",</p>
<p class="p1"><span class="Apple-converted-space">              </span>borderRadius: 6,</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">          </span>],</p>
<p class="p1"><span class="Apple-converted-space">        </span>},</p>
<p class="p1"><span class="Apple-converted-space">        </span>options: {</p>
<p class="p1"><span class="Apple-converted-space">          </span>responsive: true,</p>
<p class="p1"><span class="Apple-converted-space">          </span>animation: false,</p>
<p class="p1"><span class="Apple-converted-space">          </span>scales: {</p>
<p class="p1"><span class="Apple-converted-space">            </span>x: {</p>
<p class="p1"><span class="Apple-converted-space">              </span>grid: { display: false },</p>
<p class="p1"><span class="Apple-converted-space">              </span>ticks: { color: "var(--color-text-muted)" },</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>y: {</p>
<p class="p1"><span class="Apple-converted-space">              </span>beginAtZero: true,</p>
<p class="p1"><span class="Apple-converted-space">              </span>grid: { color: "#222831" },</p>
<p class="p1"><span class="Apple-converted-space">              </span>ticks: { color: "var(--color-text-muted)" },</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">          </span>},</p>
<p class="p1"><span class="Apple-converted-space">          </span>plugins: {</p>
<p class="p1"><span class="Apple-converted-space">            </span>legend: { display: false },</p>
<p class="p1"><span class="Apple-converted-space">            </span>tooltip: {</p>
<p class="p1"><span class="Apple-converted-space">              </span>enabled: true,</p>
<p class="p1"><span class="Apple-converted-space">              </span>backgroundColor: "var(--color-panel-bg)",</p>
<p class="p1"><span class="Apple-converted-space">              </span>titleColor: "var(--color-text-primary)",</p>
<p class="p1"><span class="Apple-converted-space">              </span>bodyColor: "var(--color-text-primary)",</p>
<p class="p1"><span class="Apple-converted-space">            </span>},</p>
<p class="p1"><span class="Apple-converted-space">          </span>},</p>
<p class="p1"><span class="Apple-converted-space">        </span>},</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Populate filter airports dropdown ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>function populateAirportFilter() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const airports = extractAirports(flights);</p>
<p class="p1"><span class="Apple-converted-space">      </span>airports.forEach((ap) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const opt = document.createElement("option");</p>
<p class="p1"><span class="Apple-converted-space">        </span>opt.value = ap;</p>
<p class="p1"><span class="Apple-converted-space">        </span>opt.textContent = ap;</p>
<p class="p1"><span class="Apple-converted-space">        </span>filterAirportSelect.appendChild(opt);</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Toggle showing all planes on map ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>function togglePlanesDisplay(show) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!show) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>planesLayerGroup.clearLayers();</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>planesLayerGroup.clearLayers();</p>
<p class="p1"><span class="Apple-converted-space">      </span>filteredFlights.forEach((f) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!f.path || f.path.length === 0) return;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lastPos = f.path[f.path.length - 1];</p>
<p class="p1"><span class="Apple-converted-space">        </span>const marker = L.circleMarker(lastPos, {</p>
<p class="p1"><span class="Apple-converted-space">          </span>radius: 6,</p>
<p class="p1"><span class="Apple-converted-space">          </span>color: "lime",</p>
<p class="p1"><span class="Apple-converted-space">          </span>fillColor: "lime",</p>
<p class="p1"><span class="Apple-converted-space">          </span>fillOpacity: 0.7,</p>
<p class="p1"><span class="Apple-converted-space">          </span>weight: 1,</p>
<p class="p1"><span class="Apple-converted-space">          </span>title: `${f.callsign || f.flight_id} (${f.pilot})`,</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>marker.bindTooltip(</p>
<p class="p1"><span class="Apple-converted-space">          </span>`&lt;strong&gt;${f.callsign || f.flight_id}&lt;/strong&gt;&lt;br&gt;${f.pilot}&lt;br&gt;${f.departure} → ${f.arrival}`,</p>
<p class="p1"><span class="Apple-converted-space">          </span>{ direction: "top" }</p>
<p class="p1"><span class="Apple-converted-space">        </span>);</p>
<p class="p1"><span class="Apple-converted-space">        </span>planesLayerGroup.addLayer(marker);</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === ADS-B Live Traffic ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Source: OpenSky Network - no auth needed for demo (limited)</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Fetch live flights near map center and display as markers, update every 30s</p>
<p class="p1"><span class="Apple-converted-space">    </span>async function fetchAdsBData() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!map) return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const center = map.getCenter();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const lat = center.lat;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const lon = center.lng;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const radios = 5; // degrees approx box</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// OpenSky API bounding box: minLat, maxLat, minLon, maxLon</p>
<p class="p1"><span class="Apple-converted-space">      </span>const url = `https://opensky-network.org/api/states/all?lamin=${lat -</p>
<p class="p1"><span class="Apple-converted-space">        </span>radios}&amp;lamax=${lat + radios}&amp;lomin=${lon - radios}&amp;lomax=${lon + radios}`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>try {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const res = await fetch(url);</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!res.ok) throw new Error("Network error");</p>
<p class="p1"><span class="Apple-converted-space">        </span>const data = await res.json();</p>
<p class="p1"><span class="Apple-converted-space">        </span>adsbLayerGroup.clearLayers();</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!data.states) return;</p>
<p class="p1"><span class="Apple-converted-space">        </span>data.states.forEach((state) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">          </span>const callsign = (state[1] || "").trim();</p>
<p class="p1"><span class="Apple-converted-space">          </span>const lat = state[6];</p>
<p class="p1"><span class="Apple-converted-space">          </span>const lon = state[5];</p>
<p class="p1"><span class="Apple-converted-space">          </span>if (lat &amp;&amp; lon) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const marker = L.circleMarker([lat, lon], {</p>
<p class="p1"><span class="Apple-converted-space">              </span>radius: 5,</p>
<p class="p1"><span class="Apple-converted-space">              </span>color: "#FF6A00",</p>
<p class="p1"><span class="Apple-converted-space">              </span>fillColor: "#FF6A00",</p>
<p class="p1"><span class="Apple-converted-space">              </span>fillOpacity: 0.8,</p>
<p class="p1"><span class="Apple-converted-space">              </span>weight: 1,</p>
<p class="p1"><span class="Apple-converted-space">              </span>title: callsign || "ADS-B Aircraft",</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>marker.bindTooltip(callsign || "ADS-B Aircraft", { direction: "top" });</p>
<p class="p1"><span class="Apple-converted-space">            </span>adsbLayerGroup.addLayer(marker);</p>
<p class="p1"><span class="Apple-converted-space">          </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Ignore errors silently for demo</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Setup periodic fetching ADS-B data every 30s</p>
<p class="p1"><span class="Apple-converted-space">    </span>function startAdsbLive() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>fetchAdsBData();</p>
<p class="p1"><span class="Apple-converted-space">      </span>setInterval(fetchAdsBData, 30000);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Google Sign-In ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Using Google Identity Services for sign-in and token</p>
<p class="p1"><span class="Apple-converted-space">    </span>// User data saved to localStorage mock persist</p>
<p class="p1"><span class="Apple-converted-space">    </span>function handleCredentialResponse(response) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Decode JWT token to get user info</p>
<p class="p1"><span class="Apple-converted-space">      </span>const jwt = response.credential;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const payload = JSON.parse(atob(jwt.split(".")[1]));</p>
<p class="p1"><span class="Apple-converted-space">      </span>userData.name = payload.name || "Google User";</p>
<p class="p1"><span class="Apple-converted-space">      </span>userData.avatar = payload.picture || userData.avatar;</p>
<p class="p1"><span class="Apple-converted-space">      </span>userNameElem.textContent = userData.name;</p>
<p class="p1"><span class="Apple-converted-space">      </span>userAvatarElem.src = userData.avatar;</p>
<p class="p1"><span class="Apple-converted-space">      </span>googleSignInBtn.hidden = true;</p>
<p class="p1"><span class="Apple-converted-space">      </span>googleSignOutBtn.hidden = false;</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Save user data to localStorage (mock)</p>
<p class="p1"><span class="Apple-converted-space">      </span>localStorage.setItem("flightlog_user", JSON.stringify(userData));</p>
<p class="p1"><span class="Apple-converted-space">      </span>initProfile();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function googleSignOut() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>googleSignInBtn.hidden = false;</p>
<p class="p1"><span class="Apple-converted-space">      </span>googleSignOutBtn.hidden = true;</p>
<p class="p1"><span class="Apple-converted-space">      </span>userData = {</p>
<p class="p1"><span class="Apple-converted-space">        </span>name: "Guest User",</p>
<p class="p1"><span class="Apple-converted-space">        </span>avatar: "https://i.pravatar.cc/96",</p>
<p class="p1"><span class="Apple-converted-space">        </span>flights: flights,</p>
<p class="p1"><span class="Apple-converted-space">      </span>};</p>
<p class="p1"><span class="Apple-converted-space">      </span>userNameElem.textContent = userData.name;</p>
<p class="p1"><span class="Apple-converted-space">      </span>userAvatarElem.src = userData.avatar;</p>
<p class="p1"><span class="Apple-converted-space">      </span>localStorage.removeItem("flightlog_user");</p>
<p class="p1"><span class="Apple-converted-space">      </span>initProfile();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function loadUserFromStorage() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const saved = localStorage.getItem("flightlog_user");</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (saved) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>try {</p>
<p class="p1"><span class="Apple-converted-space">          </span>userData = JSON.parse(saved);</p>
<p class="p1"><span class="Apple-converted-space">          </span>userNameElem.textContent = userData.name;</p>
<p class="p1"><span class="Apple-converted-space">          </span>userAvatarElem.src = userData.avatar;</p>
<p class="p1"><span class="Apple-converted-space">          </span>googleSignInBtn.hidden = true;</p>
<p class="p1"><span class="Apple-converted-space">          </span>googleSignOutBtn.hidden = false;</p>
<p class="p1"><span class="Apple-converted-space">        </span>} catch {</p>
<p class="p1"><span class="Apple-converted-space">          </span>// corrupted, ignore</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Event Listeners ===</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Sorting columns</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.querySelectorAll("#logbook-table th").forEach((th) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>th.addEventListener("click", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const key = th.dataset.sort;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (currentSort.key === key) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>currentSort.direction = currentSort.direction === "asc" ? "desc" : "asc";</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">          </span>currentSort.key = key;</p>
<p class="p1"><span class="Apple-converted-space">          </span>currentSort.direction = "asc";</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>applyFilters();</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>th.addEventListener("keydown", (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (e.key === "Enter" || e.key === " ") {</p>
<p class="p1"><span class="Apple-converted-space">          </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">          </span>th.click();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Filters input</p>
<p class="p1"><span class="Apple-converted-space">    </span>searchCallsignInput.addEventListener("input", throttle(applyFilters, 150));</p>
<p class="p1"><span class="Apple-converted-space">    </span>filterAirportSelect.addEventListener("change", applyFilters);</p>
<p class="p1"><span class="Apple-converted-space">    </span>filterDateInput.addEventListener("change", applyFilters);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Playback controls</p>
<p class="p1"><span class="Apple-converted-space">    </span>playPauseBtn.addEventListener("click", togglePlayPause);</p>
<p class="p1"><span class="Apple-converted-space">    </span>speedSlider.addEventListener("input", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>updateSpeed();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (isPlaying) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>pausePlayback();</p>
<p class="p1"><span class="Apple-converted-space">        </span>playPlayback();</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Toggle planes display</p>
<p class="p1"><span class="Apple-converted-space">    </span>togglePlanesCheckbox.addEventListener("change", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>togglePlanesDisplay(togglePlanesCheckbox.checked);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Export buttons</p>
<p class="p1"><span class="Apple-converted-space">    </span>exportGpxBtn.addEventListener("click", exportSelectedFlightGPX);</p>
<p class="p1"><span class="Apple-converted-space">    </span>exportJsonBtn.addEventListener("click", exportSelectedFlightJSON);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Google sign in/out buttons</p>
<p class="p1"><span class="Apple-converted-space">    </span>googleSignInBtn.addEventListener("click", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>google.accounts.id.prompt(); // Show prompt</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>googleSignOutBtn.addEventListener("click", googleSignOut);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Toggle sidebar button for small screens</p>
<p class="p1"><span class="Apple-converted-space">    </span>toggleSidebarBtn.addEventListener("click", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (sidebar.classList.contains("visible")) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>sidebar.classList.remove("visible");</p>
<p class="p1"><span class="Apple-converted-space">        </span>toggleSidebarBtn.textContent = "Logbook";</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>sidebar.classList.add("visible");</p>
<p class="p1"><span class="Apple-converted-space">        </span>toggleSidebarBtn.textContent = "Close";</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Close sidebar on map click for small screens</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById("map").addEventListener("click", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (window.innerWidth &lt;= 900 &amp;&amp; sidebar.classList.contains("visible")) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>sidebar.classList.remove("visible");</p>
<p class="p1"><span class="Apple-converted-space">        </span>toggleSidebarBtn.textContent = "Logbook";</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Keyboard shortcut for sidebar toggle on mobile: Ctrl+L</p>
<p class="p1"><span class="Apple-converted-space">    </span>window.addEventListener("keydown", (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (e.ctrlKey &amp;&amp; e.key.toLowerCase() === "l") {</p>
<p class="p1"><span class="Apple-converted-space">        </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">        </span>toggleSidebarBtn.click();</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// === Initialization ===</p>
<p class="p1"><span class="Apple-converted-space">    </span>function init() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>initMap();</p>
<p class="p1"><span class="Apple-converted-space">      </span>populateAirportFilter();</p>
<p class="p1"><span class="Apple-converted-space">      </span>applyFilters();</p>
<p class="p1"><span class="Apple-converted-space">      </span>initProfile();</p>
<p class="p1"><span class="Apple-converted-space">      </span>updateSpeed();</p>
<p class="p1"><span class="Apple-converted-space">      </span>togglePlanesDisplay(true);</p>
<p class="p1"><span class="Apple-converted-space">      </span>startAdsbLive();</p>
<p class="p1"><span class="Apple-converted-space">      </span>loadUserFromStorage();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Show toggle sidebar button on small screen</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (window.innerWidth &lt;= 900) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>toggleSidebarBtn.hidden = false;</p>
<p class="p1"><span class="Apple-converted-space">        </span>sidebar.classList.add("hidden");</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>toggleSidebarBtn.hidden = true;</p>
<p class="p1"><span class="Apple-converted-space">        </span>sidebar.classList.remove("hidden");</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>window.addEventListener("resize", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (window.innerWidth &lt;= 900) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>toggleSidebarBtn.hidden = false;</p>
<p class="p1"><span class="Apple-converted-space">        </span>sidebar.classList.add("hidden");</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>toggleSidebarBtn.hidden = true;</p>
<p class="p1"><span class="Apple-converted-space">        </span>sidebar.classList.remove("hidden");</p>
<p class="p1"><span class="Apple-converted-space">        </span>sidebar.classList.remove("visible");</p>
<p class="p1"><span class="Apple-converted-space">        </span>toggleSidebarBtn.textContent = "Logbook";</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Google Identity Services initialization</p>
<p class="p1"><span class="Apple-converted-space">    </span>window.onload = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>google.accounts.id.initialize({</p>
<p class="p1"><span class="Apple-converted-space">        </span>client_id:</p>
<p class="p1"><span class="Apple-converted-space">          </span>"YOUR_GOOGLE_OAUTH_CLIENT_ID.apps.googleusercontent.com",</p>
<p class="p1"><span class="Apple-converted-space">        </span>callback: handleCredentialResponse,</p>
<p class="p1"><span class="Apple-converted-space">        </span>auto_select: false,</p>
<p class="p1"><span class="Apple-converted-space">        </span>cancel_on_tap_outside: true,</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>init();</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
